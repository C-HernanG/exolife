# ExoLife Data Pipeline DAG Specification

dag_id: "exolife_data_pipeline"
description: "Complete data processing pipeline for exoplanet habitability estimation"

tasks:
  # Data fetching tasks (can run in parallel)
  fetch_nasa_data:
    task_type: "fetch"
    config:
      source: "nasa_exoplanet_archive_pscomppars"
      force_refresh: false
    dependencies: []
    retries: 2
    timeout: 300
    on_failure: "fail"

  fetch_phl_data:
    task_type: "fetch"
    config:
      source: "phl_exoplanet_catalog"
      force_refresh: false
    dependencies: []
    retries: 2
    timeout: 300
    on_failure: "fail"

  fetch_gaia_data:
    task_type: "fetch"
    config:
      source: "gaia_dr3_astrophysical_parameters"
      force_refresh: false
    dependencies: []
    retries: 2
    timeout: 600
    on_failure: "fail"

  fetch_sweet_cat:
    task_type: "fetch"
    config:
      source: "sweet_cat"
      force_refresh: false
    dependencies: []
    retries: 2
    timeout: 300
    on_failure: "fail"

  # Data validation task (depends on all fetch tasks)
  validate_data:
    task_type: "validate"
    config:
      check_completeness: true
      check_data_types: true
      min_rows_threshold: 100
    dependencies:
      - "fetch_nasa_data"
      - "fetch_phl_data"
      - "fetch_gaia_data"
      - "fetch_sweet_cat"
    retries: 1
    timeout: 120
    on_failure: "fail"

  # Data merging task (depends on validation)
  merge_baseline:
    task_type: "merge"
    config:
      strategy: "baseline"
      sources: ["nasa_exoplanet_archive_pscomppars", "phl_exoplanet_catalog"]
    dependencies:
      - "validate_data"
    retries: 1
    timeout: 300
    on_failure: "fail"

  merge_gaia_enriched:
    task_type: "merge"
    config:
      strategy: "gaia_enriched"
      sources:
        [
          "nasa_exoplanet_archive_pscomppars",
          "phl_exoplanet_catalog",
          "gaia_dr3_astrophysical_parameters",
        ]
    dependencies:
      - "validate_data"
    retries: 1
    timeout: 600
    on_failure: "fail"

  # Preprocessing tasks (depend on merge tasks)
  preprocess_hz_edges:
    task_type: "preprocess"
    config:
      preprocessor: "HZEdgesPreprocessor"
      optimistic: false
    dependencies:
      - "merge_gaia_enriched"
    retries: 1
    timeout: 180
    on_failure: "fail"

  preprocess_hz_edges_optimistic:
    task_type: "preprocess"
    config:
      preprocessor: "HZEdgesOptimisticPreprocessor"
      optimistic: true
    dependencies:
      - "preprocess_hz_edges"
    retries: 1
    timeout: 180
    on_failure: "fail"

  optimize_data_types:
    task_type: "preprocess"
    config:
      preprocessor: "DataTypeOptimizer"
    dependencies:
      - "preprocess_hz_edges_optimistic"
    retries: 1
    timeout: 120
    on_failure: "skip"

  prune_columns:
    task_type: "preprocess"
    config:
      preprocessor: "ColumnsPruner"
    dependencies:
      - "optimize_data_types"
    retries: 1
    timeout: 60
    on_failure: "skip"

  # Final validation and export
  final_validation:
    task_type: "validate"
    config:
      check_completeness: true
      check_hz_columns: true
    dependencies:
      - "prune_columns"
    retries: 1
    timeout: 60
    on_failure: "fail"

  export_data:
    task_type: "export"
    config:
      formats: ["parquet", "csv"]
      output_path: "final_dataset"
    dependencies:
      - "final_validation"
    retries: 2
    timeout: 300
    on_failure: "fail"
